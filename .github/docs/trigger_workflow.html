<!DOCTYPE html>
<html>
<head>
  <title>Trigger Workflow</title>
</head>
<body>
  <h1>Use workflow from</h1>
  <form id="workflow-form">
    <input type="checkbox" name="folders" value="folder1"> Folder 1<br>
    <input type="checkbox" name="folders" value="folder2"> Folder 2<br>
    <!-- Add more checkboxes for other folders under tas-apis -->
    <input type="submit" value="Run Workflow">
  </form>

<!-- Add this script section to the trigger_workflow.html file -->

<script>
  // Function to handle the form submission
  function handleSubmit(event) {
    event.preventDefault();

    // Get the selected folders from the workflow outputs
    const selectedFolders = document.getElementById('selected-folders').value.split(',');

    // Get the selected test type from the form
    const testTypeSelect = document.getElementById('test-type');
    const testType = testTypeSelect.options[testTypeSelect.selectedIndex].value;

    // Get the selected environment from the form
    const environmentSelect = document.getElementById('environment');
    const environment = environmentSelect.options[environmentSelect.selectedIndex].value;

    // Prepare the workflow dispatch event data
    const eventData = {
      ref: 'main', // Replace 'main' with the appropriate branch or tag name
      inputs: {
        environment: environment,
        'test-type': testType,
      },
    };

    // Add the selected folders to the event data
    selectedFolders.forEach((folder, index) => {
      eventData.inputs[`sgnum${index + 1}`] = true;
    });

    // Trigger the GitHub Actions workflow dispatch event
    fetch('/repos/your-username/your-repo/actions/workflows/your-workflow.yml/dispatches', {
      method: 'POST',
      headers: {
        Accept: 'application/vnd.github.v3+json',
        Authorization: 'token YOUR_GITHUB_PERSONAL_ACCESS_TOKEN',
      },
      body: JSON.stringify(eventData),
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error('Failed to trigger workflow.');
        }
        alert('Workflow has been triggered successfully!');
      })
      .catch((error) => {
        console.error('Error triggering workflow:', error);
        alert('An error occurred while triggering the workflow.');
      });
  }

  // Attach event listener to the form submission
  const form = document.getElementById('workflow-form');
  form.addEventListener('submit', handleSubmit);
</script>

</body>
</html>
